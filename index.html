<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fusion Studio</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script type="module">
        // Import WebLLM and make it globally available
        import * as webllm from "https://esm.run/@mlc-ai/web-llm";
        window.webllm = webllm;
    </script>
</head>
<body>
    <header class="header">
        <h1>Fusion Studio</h1>
        <div id="activeChatName">
            <div class="chat-name-container">
                <div class="stack-icon">0</div>
                <span class="stack-max">of 50</span>
            </div>
            <div id="modelSelect" class="model-select-custom">
                <div class="model-select-display">
                    <input type="text" 
                           id="modelSelectInput" 
                           class="model-select-input" 
                           placeholder="Select Model"
                           autocomplete="off"
                           spellcheck="false">
                    <button class="model-select-arrow" id="modelSelectArrow" type="button">‚ñº</button>
                </div>
                <ul id="modelSelectDropdown" class="model-select-dropdown hidden">
                    <!-- Populated by JavaScript -->
                </ul>
                <!-- Hover detail card for model info -->
                <div id="modelDetailCard" class="model-detail-card hidden">
                    <div class="model-detail-header">
                        <h3 class="model-detail-name"></h3>
                        <div class="model-detail-id"></div>
                    </div>
                    <div class="model-detail-body">
                        <div class="model-detail-description"></div>
                        <div class="model-detail-specs">
                            <div class="model-detail-spec">
                                <span class="spec-label">Context:</span>
                                <span class="spec-value model-detail-context"></span>
                            </div>
                            <div class="model-detail-spec">
                                <span class="spec-label">Input Cost:</span>
                                <span class="spec-value model-detail-input-cost"></span>
                            </div>
                            <div class="model-detail-spec">
                                <span class="spec-label">Output Cost:</span>
                                <span class="spec-value model-detail-output-cost"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <button id="apiKeyButton" class="api-key-button">Add API Key</button>
        <div class="header-right">
            <a href="readme.html" target="_blank" class="readme-link">README</a>
        </div>
    </header>
    
    <div class="main-container">
        <div class="left-panel">
            <div class="chat-list">
                <button class="chat-slot assistant-chat" id="assistant-chat-button">üí¨ Assistant</button>
                <button class="chat-slot" id="chat-slot-0">1. Empty...</button>
                <button class="chat-slot" id="chat-slot-1">2. Empty...</button>
                <button class="chat-slot" id="chat-slot-2">3. Empty...</button>
                <button class="chat-slot" id="chat-slot-3">4. Empty...</button>
                <button class="chat-slot" id="chat-slot-4">5. Empty...</button>
                <button class="chat-slot" id="chat-slot-5">6. Empty...</button>
                <button class="chat-slot" id="chat-slot-6">7. Empty...</button>
                <button class="chat-slot" id="chat-slot-7">8. Empty...</button>
                <button class="chat-slot" id="chat-slot-8">9. Empty...</button>
                <button class="chat-slot" id="chat-slot-9">10. Empty...</button>
            </div>
            <button id="clearAllButton" class="clear-all-button">Clear All</button>
        </div>
        
        <div class="middle-panel">
            <div class="middle-content">
                <div class="chat-messages" id="chatMessages">
                    <!-- Chat messages will appear here -->
                </div>
            </div>
            <div class="input-container">
                <textarea id="messageInput" placeholder="Type a message..."></textarea>
            </div>
            <div class="input-footer">
                <input type="file" accept=".json,.md" id="fileInput" style="display: none;">
                <span id="activeFile">No file loaded</span>
                <div class="footer-buttons">
                    <button id="addJsonButton">Add File</button>
                    <button id="sendButton">Send</button>
                </div>
            </div>
        </div>
        
        <!-- Phi Download Overlay -->
        <div id="phiDownloadOverlay" class="phi-download-overlay" style="display: none;">
            <div class="phi-download-content">
                <div class="phi-download-icon">üè†</div>
                <h2>Downloading Phi-3.5-mini</h2>
                <p class="phi-download-subtitle">Loading local AI model to your browser...</p>
                
                <div class="phi-progress-container">
                    <div class="phi-progress-bar">
                        <div id="phiProgressFill" class="phi-progress-fill"></div>
                    </div>
                    <div id="phiProgressText" class="phi-progress-text">0%</div>
                </div>
                
                <p class="phi-download-warning">‚ö†Ô∏è May be slower over poor connections</p>
                <p class="phi-download-size">Downloading ~2GB of model files (one-time download, cached after)</p>
                
                <div class="phi-download-alternative">
                    <p>Want to start chatting immediately?</p>
                    <button id="switchToCloudButton" class="switch-cloud-button">Switch to Cloud Model</button>
                    <p class="phi-cloud-note">Cloud models require an API key but start instantly</p>
                </div>
            </div>
        </div>
        
        <div class="right-panel">
            <div class="right-content">
                <div class="prompt-header">
                    <div class="prompt-header-left">
                        <span id="promptThreadName" class="prompt-thread-name">No chat selected</span>
                    </div>
                    <div class="prompt-header-right">
                        <button id="copyPromptButton" class="icon-button" title="Copy prompt">
                            <span class="material-icons">content_copy</span>
                        </button>
                        <button id="editPromptButton">Edit</button>
                        <div class="prompt-edit-actions" style="display: none;">
                            <button id="cancelPromptButton">Cancel</button>
                            <button id="savePromptButton">Save</button>
                        </div>
                    </div>
                </div>
                <div id="promptDisplay" class="prompt-display">No prompt loaded</div>
                <textarea id="promptText" class="prompt-editor" style="display: none;"></textarea>
            </div>
            <!-- Hover preview modal -->
            <div id="fileHoverModal" class="file-hover-modal" style="display: none;">
                <div class="file-hover-content">
                    <h3 id="fileHoverTitle" class="file-hover-title"></h3>
                    <pre id="fileHoverPreview" class="file-hover-preview"></pre>
                </div>
            </div>
            
            <!-- Prompt area context menu -->
            <div id="promptContextMenu" class="context-menu" style="display: none;">
                <div id="viewPayloadOption" class="context-menu-item">View Payload</div>
            </div>
            
            <!-- Payload modal -->
            <div id="payloadModal" class="payload-modal" style="display: none;">
                <div class="payload-modal-content">
                    <button id="closePayloadModal" class="payload-close-button">&times;</button>
                    <h3>API Payload</h3>
                    <pre id="payloadDisplay" class="payload-display">Send a chat request to view the payload...</pre>
                </div>
            </div>
        </div>
    </div>
    
    <div id="contextMenu" class="context-menu">
        <div class="context-menu-item" id="renameOption">Rename</div>
        <div class="context-menu-item" id="exportOption">Export Chat</div>
        <div class="context-menu-item" id="clearDataOption">Clear Data</div>
    </div>
    
    <div id="userBubbleMenu" class="context-menu">
        <div class="context-menu-item" id="regenerateOption">Regenerate</div>
        <div class="context-menu-item" id="deleteOption">Delete</div>
        <div class="context-menu-item" id="editOption">Edit</div>
    </div>
    
    <script src="app.js"></script>
</body>
</html>

